# drupal-geo-starter

**Drupal 11** project managed by **Composer** with docroot in `web/`. Clean starter repo with `.gitignore`, `.gitattributes` and `.editorconfig`.

---

## Prerequisites

- **PHP 8.2+** (common extensions: intl, gd, mbstring, xml, pdo_pgsql or pdo_mysql, zip)
- **Composer 2**
- **Database**: PostgreSQL 14+ (or MySQL/MariaDB)
- (Optional) **Node.js** for front-end build in custom theme

---

## Local Installation (existing)

The repo already contains `composer.json`/`lock`.

```bash
# 1) Install dependencies
composer install

# 2) Create a local vhost OR start the built-in PHP server
php -S 127.0.0.1:8080 -t web web/.ht.router.php
# ➜ site accessible at http://127.0.0.1:8080
```

---

## Drupal Site Installation

Two ways: **via UI** (browser) or **via Drush**.

### A) Via UI

1. Start the server (see above)
2. Go to `http://127.0.0.1:8080`
3. Follow the installer (choose Standard) and provide your DB URL

### B) Via Drush

Install Drush first if missing:

```bash
composer require drush/drush --dev
```

Install the site:

```bash
# PostgreSQL
vendor/bin/drush site:install standard \
  --db-url="pgsql://USER:PASS@127.0.0.1:5432/DBNAME" \
  --site-name="Drupal Geo Starter" -y

# (MySQL)
# vendor/bin/drush site:install standard \
#   --db-url="mysql://USER:PASS@127.0.0.1:3306/DBNAME" \
#   --site-name="Drupal Geo Starter" -y
```

**Important**: `web/sites/default/settings.php` is ignored by Git. For local overrides, use `settings.local.php` instead (see below).

---

## Configuration & Secrets

### Recommended Files

- `web/sites/default/settings.php` ➜ generated by installer, **not versioned**
- `web/sites/default/settings.local.php` ➜ local overrides, **not versioned**
- `web/sites/development.services.yml` ➜ included by default for dev mode

Minimal example of `settings.local.php`:

```php
<?php
$databases['default']['default'] = [
  'driver' => 'pgsql', // or 'mysql'
  'database' => 'appdb',
  'username' => 'jerome',
  'password' => 'changeme',
  'host' => '127.0.0.1',
  'port' => '5432',
  'prefix' => '',
];

$settings['config_sync_directory'] = DRUPAL_ROOT . '/../config/sync';
$settings['hash_salt'] = 'CHANGE_ME';
```

---

## Configuration Export / Import

Enable **Drush** to manage config.

```bash
# Define sync directory (already pointed in the example above)
# $settings['config_sync_directory'] = DRUPAL_ROOT . '/../config/sync';

# Export
vendor/bin/drush cex -y

# Import
vendor/bin/drush cim -y
```

Version the `config/sync/` directory in Git.

---

## Useful Commands

```bash
# Status
composer show drupal/core-recommended | grep versions
vendor/bin/drush status

# Cache
vendor/bin/drush cr

# Administrator accounts
vendor/bin/drush uli          # Unique login link
vendor/bin/drush user:password admin "new_password"

# Modules
vendor/bin/drush en devel -y  # enable
vendor/bin/drush pmu devel -y # uninstall
```

---

## Local Development

- Built-in PHP server: `php -S 127.0.0.1:8080 -t web web/.ht.router.php`
- Logs: `web/*-debug.log` ignored by Git
- Custom themes: place in `web/themes/custom/` (remember to ignore build directories `dist/`, `.cache/`)

---

## Deployment (generic)

1. `composer install --no-dev --optimize-autoloader`
2. Sync `config/sync` ➜ `drush cim -y`
3. Run `drush updb -y` (DB updates) and `drush cr`
4. Ensure `sites/*/files` is present and writable (not versioned)

---

## Git Structure

- Versioned: `composer.*`, `web` (without `core`/`contrib`/`settings.php`), `recipes/`, `config/sync/`, project files
- Ignored: `vendor/`, `web/core/`, `web/*/contrib/`, `web/sites/*/files`, `web/sites/*/settings*.php`

---

## License

MIT license

---

## Notes

- Project designed for Windows/Linux/macOS.
- If you use PostgreSQL locally, remember to adapt `driver`, `port` and credentials.
- In case of "empty import" config import error: check that `config/sync` contains exported files and that the path is properly defined in `settings*.php`.
